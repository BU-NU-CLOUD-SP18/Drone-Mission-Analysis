<!DOCTYPE html>
<html ng-app="myApp">

<head>
<title>Dynamic ngMap demo</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maps.google.com/maps/api/js?libraries=placeses,visualization,drawing,geometry,places"></script>
<script src="https://code.angularjs.org/1.3.15/angular.js"></script>
<script src="https://rawgit.com/allenhwkim/angularjs-google-maps/master/build/scripts/ng-map.js"></script>
<script>
  var app = angular.module('myApp', ['ngMap']);

  app.controller('mapController', function($interval) {
    var vm = this;
    vm.positions = [];
    var generateMarkers = function() {
      vm.positions = [];
      /*var numMarkers = Math.floor(Math.random() * 4) + 4; //between 4 to 8 markers
      for (i = 0; i < numMarkers; i++) {
        var lat = 43.6600000 + (Math.random() / 100);
        var lng = -79.4103000 + (Math.random() / 100);
        vm.positions.push({lat:lat, lng:lng});
      }*/
      $.ajax({
        url : 'http://127.0.0.1:8081/visualization',
        type: 'GET',

      }).done(function(data){

        for(i =0;i<data.wayPoints.length;i++) {
          vm.positions.push({lat: data.wayPoints[i].latitude, lng: data.wayPoints[i].longitude});
        }
      })
      console.log("vm.positions", vm.positions);
    };
    //generateMarkers();
  $interval(generateMarkers, 2000);
  });
</script>
</head>

<body>
  <h1>Dynamic Markers Demo Using ng-repeat</h1>
  <hr />

  <div ng-controller="mapController as vm">
    <ng-map zoom="14" center="[43.6650000, -79.4103000]">
      <marker ng-repeat="pos in vm.positions" position="{{pos.lat}},{{pos.lng}}"></marker>
    </ng-map>
  </div>
</body>
</html>
